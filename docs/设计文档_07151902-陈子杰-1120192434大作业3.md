班级：07151902          姓名：陈子杰          学号：1120192434

# Assignment 3：Design and Implementation

> 题目要求：完成从系统需求开始、功能设计、数据库设计、软件编码、软件测试、软件使用全过程，反映到最终表实现，不得少于6张

[TOC]

# 〇、加分项说明

> 6张表，有增删改查

完成11张表，交互式增删改查

（完成）



> 有界面级联操作

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114751407.png" alt="image-20210611114751407" style="zoom: 25%;" />

点击参赛队右侧出现对应的运动员和教练员

在左侧增删改参赛队；选择参赛队后，在右侧增删改选定参赛队中的，运动员与教练员信息

（完成）



> 有权限管理

包含运动员权限，教练员权限，参赛队管理员权限，主办方管理员权限

详细见功能设计与软件编码

（完成）



> 有触发器、存储过程

见数据库设计中的3.2和3.3

同时下方高斯数据库，也有触发器和存储过程的记录

（完成）



> Delphi 7 / Delphi 2010

由于Delphi界面存在闪退等问题，无法正常完成作业

选择同Delphi相类似的C# winform开发框架进行开发，界面美观，功能完善，交互性强



> 后台华为Gauss数据库

连接成功证明：

表：

![表](D:\college\数据库原理与设计\大作业\Assignment 3\pic\表.png)

存储过程：

![存储过程](D:\college\数据库原理与设计\大作业\Assignment 3\pic\存储过程.png)

触发器：

![触发器](D:\college\数据库原理与设计\大作业\Assignment 3\pic\触发器.png)

（完成）

# 一、需求分析

​        高等院校运动会是高校体育工作的重要组成部分。近年来，随着招生规模的扩大与国家对“全民健康”关注度的提升，比赛频率、比赛项目、参赛人数不断增加，同时人们对比赛报名的操作方便性要求也越来越高，参赛队需要更加便捷高效的运动会报名系统。这些问题和需求是人工方式所难以解决的。对此，我以首都地区高等院校的运动会报名为例，对运动会的报名系统进行了研究，调研了不同职责人员的需求。由此，我开发出一套适合高等院校的运动会报名系统，使运动会的创建、报名、组织、管理等工作全面实现了计算机网络化、自动化，极大的提高了操作的便捷性与工作效率。

# 二、功能设计

​        为始应高校运动会报名期间不同身份人员的不同需求，该系统特意为不同身份的操作人员提供不同功能，即包含权限管理操作。同时，级联操作使不同权限人员的操作相互关联。下面将逐一介绍每一种操作人员的身份和与其相对应的功能与限制。

## 1. 运动员权限

​        运动员可以实现注册与查看自身所处参赛队的功能。限制为无法自身报名参赛队，无法将自身信息激活与无法对其他账号注册的运动员进行操作。总结为：运动员仅可提交注册信息与查看自身参赛队，无法更改其他信息和查看与自身无关的信息。

## 2. 教练员权限

​        教练员可以实现注册与查看自身所处参赛队的功能。限制为无法自身报名参赛队，无法将自身信息激活与无法对其他账号注册的教练员进行操作。总结为：教练员仅可提交注册信息与查看自身参赛队，无法更改其他信息和查看与自身无关的信息。

## 3. 参赛队管理员权限

​        参赛队管理员可以实现组建参赛队，与查看指定运动会及学校的，全体生效人员信息的功能。限制为无法更改除参赛队以外的全部信息，以及操作指定学校需要特定验证码，以及无法为任何单位激活。总结为：参赛队管理员仅可查看指定运动会学校的全部信息与组建参赛队，无法更改其他信息和激活任何单位。

## 4. 主办方管理员权限

​        主办方管理员可以实现管理运动会，与为所有单位激活的功能。其中管理运动会包括更改运动会基本信息与增删改运动会项目。限制为无法更改除运动会以外的全部信息。总结为：主办方管理员可管理运动会，查看全部信息与为全部单位激活，无法更改运动会以外其他信息。

## 5. 表格查看

|     **模块**     |      **名称**      |                          **功能**                          |
| :--------------: | :----------------: | :--------------------------------------------------------: |
|    运动员模块    |      基本查询      |                通过运动员名称查询运动员信息                |
|    运动员模块    |      基本注册      |                   在系统中保存运动员信息                   |
|    运动员模块    |     查询参赛队     |                查询生效运动员所属参赛队信息                |
|    教练员模块    |      基本查询      |                通过教练员名称查询教练员信息                |
|    教练员模块    |      基本注册      |                   在系统中保存教练员信息                   |
|    教练员模块    |     查询参赛队     |                查询生效教练员所属参赛队信息                |
| 参赛队管理员模块 |  查询本校生效信息  |           通过名称查询本校生效运动员与教练员信息           |
| 参赛队管理员模块 | 查询运动会项目信息 |                 通过名称查询运动会项目信息                 |
| 参赛队管理员模块 |     组建参赛队     |             输入运动员教练员参赛信息组建参赛队             |
| 主办方管理员模块 |      基本查询      | 通过名称查询所有运动员、教练员参赛队以及运动会对应项目信息 |
| 主办方管理员模块 |      激活信息      |                 激活运动员、教练员与参赛队                 |
| 主办方管理员模块 |   更改运动会信息   |                更改运动会基本信息与项目信息                |

# 三、数据库设计

​        需求分析之后，数据库设计的其他阶段包括概念结构设计阶段，逻辑结构设计阶段，物理设计阶段，下面将逐一介绍。

## 1. 概念模型设计阶段

### 1.1 概念阐述

>  通过对用户需求进行综合、归纳与抽象，形成一个独立于具体DBMS的概念模型

### 1.2 E-R绘制

![image-20210611094128621](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611094128621.png)

## 2. 逻辑结构设计阶段

​        在概念模型设计阶段解决了客户的需求，并绘制了 E-R图。逻辑结构设计的任务，就是把在概要结构设计阶段建立的基本 E-R 图，按选定的关系数据模型的原则转换成相应的数据库模型图。

### 2.1 将E-R图转化为关系模型

在将实体属性以及实体之间关系转化后，得到的关系模式R(A,B)如下

> 登录模块

- 运动员登录（<u>运动员账号</u>，运动员密码）
- 教练员登录（<u>教练员账号</u>，教练员密码）
- 参赛队管理员登录（<u>参赛队管理员账号</u>，参赛队管理员密码）
- 主办方管理员登录（<u>主办方管理员账号</u>，主办方管理员密码）

> 注册模块

- 运动员注册（<u>运动员编号</u>，运动员账号，姓名，性别，学校，入学时间，毕业时间，教练员编号，生效标记）
- 教练员注册（<u>教练员编号</u>，教练员账号，姓名，学校，职称，生效标记）

> 运动会信息模块

- 运动会信息（<u>运动会编号</u>，运动会名称，主办单位，承办单位，地点，比赛时间，结束时间，生效标记）
- 项目信息（<u>项目编号</u>，运动会编号，项目名称，项目类型，团体项目标记）

> 参赛信息模块

- 运动员信息（<u>运动员编号</u>，<u>参赛队编号</u>，号码，报名项目一，报名项目二）
- 教练员信息（<u>教练员编号</u>，<u>参赛队编号</u>）
- 参赛队信息（<u>参赛队编号</u>，运动会编号，学校，参赛队全称，最小号码，最大号码，生效标记）

> 总计：共11张表

### 2.2 证明数据表结构设计范式

> 3NF定义：**所有字段只能依赖主键，不得依赖于其它字段。**

以运动员信息表为例

∵ 主键包含运动员编号和参赛队编号

且

（运动员编号，参赛队编号) -> 号码

（运动员编号，参赛队编号) -> 报名项目一

（运动员编号，参赛队编号) -> 报名项目二

无属性依赖于主键以外的属性

∴ 满足3NF

其他数据表同理

## 3. 物理设计阶段

### 3.1 建表

在数据库中建立表

> 登录模块

- 运动员登录（<u>运动员账号</u>，运动员密码）

  ```sql
  CREATE TABLE 运动员登录表(
      运动员账号 VARCHAR(50) PRIMARY KEY ,
      密码 VARCHAR(50) NOT NULL ,
  )
  ```

  

- 教练员登录（<u>教练员账号</u>，教练员密码）

  ```sql
  CREATE TABLE 教练员信息表(
      教练员ID VARCHAR(50) PRIMARY KEY ,
      参赛队ID VARCHAR(50) NOT NULL ,
  )
  ```

  

- 参赛队管理员登录（<u>参赛队管理员账号</u>，参赛队管理员密码）

  ```sql
  CREATE TABLE 参赛队管理员登录表(
      参赛队管理员账号 VARCHAR(50) PRIMARY KEY ,
      密码 VARCHAR(50) NOT NULL ,
  )
  ```

  

- 主办方管理员登录（<u>主办方管理员账号</u>，主办方管理员密码）

- ```sql
  CREATE TABLE 主办方管理员登录表(
      主办方管理员账号 VARCHAR(50) PRIMARY KEY ,
      密码 VARCHAR(50) NOT NULL ,
  )
  ```

  

> 注册模块

- 运动员注册（<u>运动员编号</u>，运动员账号，姓名，性别，学校，入学时间，毕业时间，教练员编号，生效标记）

  ```sql
  CREATE TABLE 运动员注册表(
      运动员ID VARCHAR(50) PRIMARY KEY ,
      运动员账号 VARCHAR(50) NOT NULL ,
      姓名 VARCHAR(50) NOT NULL ,
      性别 VARCHAR(50) NOT NULL ,
      学校 VARCHAR(50) NOT NULL,
      入学时间 DATE NOT NULL ,
      毕业时间 DATE NOT NULL ,
      教练员ID VARCHAR(50) NOT NULL ,
      生效标记 TINYINT NOT NULL DEFAULT 0,
      
      FOREIGN KEY (运动员账号) REFERENCES 运动员登录表(运动员账号)
      ON DELETE CASCADE
      ON UPDATE CASCADE,
      
      FOREIGN KEY (教练员ID) REFERENCES 教练员注册表(教练员ID)
      ON DELETE CASCADE
      ON UPDATE CASCADE
  )
  ```



- 教练员注册（<u>教练员编号</u>，教练员账号，姓名，学校，职称，生效标记）

```sql
CREATE TABLE 教练员注册表(
    教练员ID VARCHAR(50) PRIMARY KEY ,
    教练员账号 VARCHAR(50) NOT NULL ,
    姓名 VARCHAR(50) NOT NULL ,
    学校 VARCHAR(50) NOT NULL ,
    职称 VARCHAR(50) NOT NULL ,
    生效标记 TINYINT NOT NULL DEFAULT 0,
)
```







> 运动会信息模块

- 运动会信息（<u>运动会编号</u>，运动会名称，主办单位，承办单位，地点，比赛时间，结束时间，生效标记）

  ```sql
  CREATE TABLE 运动会信息表(
      运动会ID  VARCHAR(50) PRIMARY KEY ,
      运动会名称 VARCHAR(50) NOT NULL ,
      主办单位 VARCHAR(50) NOT NULL ,
      承办单位 VARCHAR(50) NOT NULL ,
      地点 VARCHAR(50) NOT NULL ,
      比赛时间 DATE NOT NULL ,
      结束时间 DATE NOT NULL,
      生效标记 TINYINT NOT NULL DEFAULT 0
  )
  ```

  

- 项目信息（<u>项目编号</u>，运动会编号，项目名称，项目类型，团体项目标记）

  ```sql
  CREATE TABLE 项目信息表(
      项目ID VARCHAR(50) PRIMARY KEY ,
      运动会ID VARCHAR(50) NOT NULL  ,
      项目名称 VARCHAR(50) NOT NULL ,
      项目类型 VARCHAR(50) NOT NULL ,
      团体项目标记 TINYINT NOT NULL,
      
      FOREIGN KEY (运动会ID) REFERENCES 运动会信息表(运动会ID)
      ON DELETE CASCADE
      ON UPDATE CASCADE,
  )
  ```

  

> 参赛信息模块

- 运动员信息（<u>运动员编号</u>，<u>参赛队编号</u>，号码，报名项目一，报名项目二）

  ```sql
  CREATE TABLE 运动员信息表(
      运动员ID VARCHAR(50) NOT NULL ,
      参赛队ID VARCHAR(50) NOT NULL ,
      号码 VARCHAR(50) NOT NULL ,
      报名项目一 VARCHAR(50) NOT NULL ,
      报名项目二 VARCHAR(50),
  
      PRIMARY KEY (运动员ID,参赛队ID),
  
      FOREIGN KEY (参赛队ID) REFERENCES 参赛队信息表(参赛队ID)
      ON DELETE CASCADE
      ON UPDATE CASCADE
  )
  ```

  

- 教练员信息（<u>教练员编号</u>，<u>参赛队编号</u>）

```sql
CREATE TABLE 教练员信息表(
    教练员ID VARCHAR(50)NOT NULL ,
    参赛队ID VARCHAR(50) NOT NULL ,

    PRIMARY KEY (教练员ID,参赛队ID),

    FOREIGN KEY (参赛队ID) REFERENCES 参赛队信息表(参赛队ID)
    ON DELETE CASCADE
    ON UPDATE CASCADE
)
```



- 参赛队信息（<u>参赛队编号</u>，运动会编号，学校，参赛队全称，最小号码，最大号码，生效标记）

  ```sql
  CREATE TABLE 参赛队信息表(
      参赛队ID VARCHAR(50) PRIMARY KEY ,
      运动会ID VARCHAR(50) NOT NULL  ,
      学校 VARCHAR(50) NOT NULL,
      参赛队全称 VARCHAR(50) NOT NULL ,
      最小号码 VARCHAR(50) NOT NULL ,
      最大号码 VARCHAR(50) NOT NULL ,
      生效标记 TINYINT NOT NULL DEFAULT 0,
      
      FOREIGN KEY (运动会ID) REFERENCES 运动会信息表(运动会ID)
      ON DELETE CASCADE
      ON UPDATE CASCADE,
  )
  ```

### 3.2 触发器

​        删除参赛队时，将位于此参赛队的参赛运动员信息与参赛教练员信息删除

```sql
CREATE TRIGGER delete_cansaidui
    ON 参赛队信息表
    AFTER DELETE
    AS
    BEGIN
        DELETE 运动员信息表 WHERE 运动员信息表.参赛队ID IN (SELECT 参赛队ID FROM deleted)
        DELETE 教练员信息表 WHERE 教练员信息表.参赛队ID IN (SELECT 参赛队ID FROM deleted)
    END
GO
```

​        运动会失效时，将绑定参加此运动会的参赛队信息归为失效

```sql
CREATE TRIGGER delete_yundonghui
    ON 运动会信息表
    AFTER UPDATE
    AS
    BEGIN
        UPDATE 参赛队信息表 SET 生效标记 = 0 WHERE 参赛队信息表.运动会ID IN (SELECT 运动会ID FROM deleted)
    END
GO

```



### 3.3 存储过程

​        运动员编号检查（包括重复、是否存在与是否被激活）

```sql

CREATE PROCEDURE check_ID_yundongyuan
    @运动员ID VARCHAR(50),
    @参赛队ID VARCHAR(50),
    @学校 VARCHAR(50)
AS
    IF(@运动员ID IN (SELECT 运动员ID FROM 运动员信息表 WHERE 参赛队ID = @参赛队ID)) RETURN 0
    IF(@运动员ID NOT IN (SELECT 运动员ID FROM 运动员注册表 WHERE 生效标记=1 AND 学校 = @学校)) RETURN 0
    RETURN 1
GO
```



​        教练员编号检查（包括重复、是否存在与是否被激活）

```sql
CREATE PROCEDURE check_ID_jiaolianyuan
    @教练员ID VARCHAR(50),
    @参赛队ID VARCHAR(50),
    @学校 VARCHAR(50)
AS
    IF(@教练员ID IN (SELECT 教练员ID FROM 教练员信息表 WHERE 参赛队ID = @参赛队ID)) RETURN 0
    IF(@教练员ID NOT IN (SELECT 教练员ID FROM 教练员注册表 WHERE 生效标记=1 AND 学校 = @学校)) RETURN 0
    RETURN 1
GO
```



​        项目检查（包括报名的两个项目是否在运动会中）

```sql
CREATE PROCEDURE check_xiangmu
    @项目ID1 VARCHAR(50),
    @项目ID2 VARCHAR(50),
    @运动会ID VARCHAR(50)
AS
    IF(@项目ID1 NOT IN (SELECT 项目ID FROM 项目信息表 WHERE 运动会ID = @运动会ID)) RETURN 0
    IF(@项目ID2 NOT IN (SELECT 项目ID FROM 项目信息表 WHERE 运动会ID = @运动会ID)) RETURN 0
    RETURN 1
GO
```



​        号码检查（包括是否重复和是否在号码范围）

```sql
CREATE PROCEDURE check_haoma
    @号码 VARCHAR(50),
    @参赛队ID VARCHAR(50)
AS
    IF(@号码 IN (SELECT 号码 FROM 运动员信息表 WHERE 参赛队ID = @参赛队ID)) RETURN 0
    RETURN 1
GO
```



​        获取最大号码

```sql
CREATE PROCEDURE get_max
    @参赛队ID VARCHAR(50)
AS
    RETURN (SELECT 最大号码 FROM 参赛队信息表 WHERE 参赛队ID = @参赛队ID)
GO
```

​        获取最小号码

```sql
CREATE PROCEDURE get_min
    @参赛队ID VARCHAR(50)
AS
    RETURN (SELECT 最大号码 FROM 参赛队信息表 WHERE 参赛队ID = @参赛队ID)
GO
```

# 四、软件编码

## 1. 连接数据库类代码

运行前输入电脑型号以连接数据库

```c#
string DataSource1 = Interaction.InputBox("请输入电脑型号", "连接数据库", "在这里输入", -1, -1);
Public_val.DataSource = DataSource1;
```

构造函数：连接并打开数据库

```C#
class Dao
    {
        SqlConnection con;
        /// <summary>
        /// 构造函数，连接上数据库
        /// </summary>
        public Dao()
        {
            //打开数据库字符串构建
            SqlConnectionStringBuilder builder = new SqlConnectionStringBuilder();
            builder.DataSource = "LAPTOP-BOHGV8VH";
            builder.DataSource = Public_val.DataSource;
            builder.IntegratedSecurity = true;
            builder.InitialCatalog = "Assignment3_Design_And_Implementation";

            //打开数据库
            SqlConnection sqlConnection = new SqlConnection(builder.ToString());
            con = sqlConnection;
            if(con.State == System.Data.ConnectionState.Closed)
                con.Open();
        }
```

sql命令构建

```C#
/// <summary>
        /// sql命令构建
        /// </summary>
        /// <param name="sql">需要执行的sql语句</param>
        /// <returns></returns>
        private SqlCommand command(string sql)
        {
            SqlCommand com = new SqlCommand(sql,con);
            return com;
        }

        /// <summary>
        /// 用于UPDATE,DELETE,INSERT INTO等语句,返回受影响的行数
        /// </summary>
        /// <param name="sql">需要执行的sql语句</param>
        /// <returns></returns>
        public int Excute(string sql)
        {
            return command(sql).ExecuteNonQuery();
        }

        /// <summary>
        /// 用于SELECT语句,返回SELECT到的数据
        /// </summary>
        /// <param name="sql">需要执行的sql语句</param>
        /// <returns></returns>
        public SqlDataReader Read(string sql)
        {
            return command(sql).ExecuteReader();
        }

        public DataTable SqlDataGridView_Show(string sql,string title)
        {
            //执行查询语句
            SqlDataAdapter adapter = new SqlDataAdapter(sql, con);
            DataSet dataset = new DataSet();
            adapter.Fill(dataset,title);//参数二：表名，自己选择

            //绑定数据到DataGridView
            return dataset.Tables[title];
        }

        public SqlDataAdapter SqlProcedure(String name)
        {
            return new SqlDataAdapter(name, con);
        }
    }
```



## 2. 公有信息类代码

用于向不同窗口传递值

```C#
/// <summary>
    /// 全部窗体共有数据
    /// </summary>
    public static class Public_val
    {
        private static String zhanghao="1";
        private static String yundonghui = "1";
        private static String xuexiao = "1";

        //更改
        public static bool change_flag = false;
        public static String change_xuhao = "";
        //主页键
        public static bool home_flag = false;

        public static String DataSource = "";

        public static String get_zhanghao() { return zhanghao; }
        public static void set_zhanghao(String s) { zhanghao=s; }

        public static String get_yundonghui() { return yundonghui; }
        public static void set_yundonghui(String s) { yundonghui = s; }

        public static String get_xuexiao() { return xuexiao; }
        public static void set_xuexiao(String s) {xuexiao = s; }
    }
```



## 3. 登录与注册界面

![image-20210611102429522](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611102429522.png)

### 3.1 基本登录

​        输入账号密码，选择权限，点击“登录”按钮登录

检查内容：填写不完整

```C#
/// <summary>
        /// 登录按钮点击操作
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void denglu_button_Click(object sender, EventArgs e)
        {
            if (login()) //查询结果存在
            {
                //为之后的窗口传值
                Public_val.set_zhanghao(username);

                //打开不同的窗口
                if(identity == "参赛队管理员")
                {
                    Sports_Meetings sports = new Sports_Meetings();
                    this.Hide();//隐藏登录的界面
                    sports.ShowDialog();
                    this.Show();
                }
                else if(identity == "主办方管理员")
                {
                    Sports_Meetings_zhuban sports = new Sports_Meetings_zhuban();
                    this.Hide();//隐藏登录的界面
                    sports.ShowDialog();
                    this.Show();
                }
                else if(identity == "运动员")
                {
                    yundongyuan_caozuo sports = new yundongyuan_caozuo();
                    this.Hide();//隐藏登录的界面
                    sports.ShowDialog();
                    this.Show();
                }
                else if(identity == "教练员")
                {
                    jiaolianyuan_caozuo sports = new jiaolianyuan_caozuo();
                    this.Hide();//隐藏登录的界面
                    sports.ShowDialog();
                    this.Show();
                }
            }
        }

        /// <summary>
        /// 查询函数
        /// </summary>
        /// <returns>返回查询是否成功</returns>
        private bool login()
        {
            //从输入栏取出信息
            username = zhanghao_textbox.Text.Trim(); //取出用户名
            String password = mima_textbox.Text.Trim(); //取出密码
            identity = quanxian_combobox.Text.Trim();//取出用户身份

            //返回填写不完整提醒
            if (username == "请输入账号" || password == "请输入密码" || identity == "——请选择身份——")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK ,MessageBoxIcon.Warning);
                return false;
            }

            String sql = "SELECT * FROM " + identity + "登录表 WHERE "+identity+"账号='" + username + "'AND 密码='" + password +  "'";//SQL查询语句
            //创建读数据库对象
            Dao data = new Dao();
            //读取数据
            SqlDataReader information = data.Read(sql);

            //若登陆成功
            if (information.HasRows)
            {
                MessageBox.Show("登录成功！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Asterisk);//设置弹出对话窗
                return true;
            }
            //若登陆失败
            else
            {
                MessageBox.Show("用户名或密码错误！", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }
        }
```



### 3.2 更改密码

​        点击下方“更改密码”文字，进入更改密码界面

![image-20210611102527965](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611102527965.png)

清空按钮：

```c#
private void qingkong_Click(object sender, EventArgs e)
        {
            zhanghao_textbox.Text = "";
            zhanghao_textbox.ForeColor = Color.Gray;
            mima_textbox.Text = "";
            mima_textbox.ForeColor = Color.Gray;
            mima_textbox2.Text = "";
            mima_textbox2.ForeColor = Color.Gray;
            quanxian_combobox.SelectedIndex = 0;
            quanxian_combobox.ForeColor = Color.Gray;
        }
```

更改按钮：

检查内容：

1. 填写是否完整
2. 原密码是否填写正确

```C#
private void zhuce_Click(object sender, EventArgs e)
        {
            if (login())
            {
                MessageBox.Show("更改密码成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                this.Close();
            }
        }

        private  bool login()
        {
            //从输入栏取出信息
            String username = zhanghao_textbox.Text.Trim(); //取出用户名
            String password = mima_textbox.Text.Trim(); //取出密码
            String password_2 = mima_textbox2.Text.Trim(); //取出重复密码
            String identity = quanxian_combobox.Text.Trim();//取出用户身份

            //返回填写不完整提醒
            if (identity == "——请选择您的身份——")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }

            Dao data_read = new Dao();
            //检查用户名是否已经被注册
            String sql = "SELECT * FROM " + identity + "登录表 WHERE " + identity + "账号='" + username + "';";//SQL查询语句
                                                                                                         //创建读数据库对象
            SqlDataReader information = data_read.Read(sql);

            if (information.HasRows == false)
            {
                MessageBox.Show("该账号名不存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            //检查输入是否完整
            if (username == "" || password == "" || password_2 == "" ||
                username == "请输入您所要创建的账号" || password == "请输入登录密码" || password_2 == "请再次输入登录密码")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }

            //第一次密码必须和之前对应

            Dao data_mima = new Dao();

            sql = "SELECT * FROM " + identity + "登录表 WHERE " + identity + "账号='" + username + "' AND 密码 = '"+ password +"';";//SQL查询语句
                                                                                                         //创建读数据库对象
            SqlDataReader mima = data_mima.Read(sql);

            if (mima.HasRows == false)
            {
                MessageBox.Show("原密码输入错误", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            //更改用户密码

            Dao data_excute = new Dao();

            sql = "UPDATE " + identity + "登录表 SET 密码 = '"+password_2+"' WHERE " + identity + "账号 = '" + username + "';";//SQL插入数据语句
            int num = data_excute.Excute(sql);

            //返回信息值
            if (num == 1)
                return true;
            else
                return false;
        }
```



### 3.3 基本注册

​        点击下方“注册”按钮，进入注册界面

![image-20210611102541854](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611102541854.png)

清空按钮：

```C#
        private void qingkong_Click(object sender, EventArgs e)
        {
            zhanghao_textbox.Text = "";
            zhanghao_textbox.ForeColor = Color.Gray;
            mima_textbox.Text = "";
            mima_textbox.ForeColor = Color.Gray;
            mima_textbox2.Text = "";
            mima_textbox2.ForeColor = Color.Gray;
            quanxian_combobox.SelectedIndex = 0;
            quanxian_combobox.ForeColor = Color.Gray;
            guanliyuan_textbox.Text = "";
            guanliyuan_textbox.ForeColor = Color.Gray;
        }
```

注册按钮：

检查内容：

1. 账号是否已经被注册
2. 填写是否完整
3. 两次填写密码是否相同
4. 管理员验证码是否填写正确

```C#
private void zhuce_Click(object sender, EventArgs e)
        {
            if (login())
            {
                MessageBox.Show("注册成功", "欢迎您，新用户！", MessageBoxButtons.OK, MessageBoxIcon.Information);
                this.Close();
            }
        }

        private  bool login()
        {
            //从输入栏取出信息
            String username = zhanghao_textbox.Text.Trim(); //取出用户名
            String password = mima_textbox.Text.Trim(); //取出密码
            String password_2 = mima_textbox2.Text.Trim(); //取出重复密码
            String identity = quanxian_combobox.Text.Trim();//取出用户身份
            String guanliyuan = guanliyuan_textbox.Text.Trim();//取出管理员验证码

            //返回填写不完整提醒
            if (identity == "——请选择您的身份——")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }
            //若为运动员或教练员
            else if (identity == "运动员" || identity == "教练员")
            {
                if (username == "" || password == "" || password_2 == ""||
                    username == "请输入您所要创建的账号" || password == "请输入登录密码" || password_2 == "请再次输入登录密码")
                {
                    MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                //两次密码必须相同
                if (password != password_2)
                {
                    MessageBox.Show("两次输入的密码必须相同！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                Dao data_read = new Dao();
                //检查用户名是否已经被注册
                String sql = "SELECT * FROM " + identity + "登录表 WHERE " + identity + "账号='" + username + "'";//SQL查询语句
                //创建读数据库对象
                SqlDataReader information = data_read.Read(sql);

                if (information.HasRows)
                {
                    MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return false;
                }

                Dao data_excute = new Dao();

                //插入用户信息

                sql = "INSERT INTO "+identity+"登录表 VALUES ('"+username+"','"+password+"');";//SQL插入数据语句
                int num = data_excute.Excute(sql);

                //返回信息值
                if (num == 1)
                    return true;
                else
                    return false;
            }
            //若为管理员
            else
            {
                if (username == "" || password == "" || password_2 == "" || guanliyuan == "" ||
                    username == "请输入您所要创建的账号" || password == "请输入登录密码" || password_2 == "请再次输入登录密码"||
                    guanliyuan== "请输入参赛队管理员验证码" ||guanliyuan== "请输入主办方管理员验证码")
                {
                    MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                //两次密码必须相同
                if (password != password_2)
                {
                    MessageBox.Show("两次输入的密码必须相同！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                if (identity == "参赛队管理员")
                {
                    if (guanliyuan != "123")
                    {
                        MessageBox.Show("参赛队管理员验证码错误！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        return false;
                    }
                }
                else if (identity == "主办方管理员")
                {
                    if (guanliyuan != "abc")
                    {
                        MessageBox.Show("主办方管理员验证码错误！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        return false;
                    }
                }

                Dao data_read = new Dao();
                //检查用户名是否已经被注册
                String sql = "SELECT * FROM " + identity + "登录表 WHERE " + identity + "账号='" + username + "'";//SQL查询语句
                //创建读数据库对象
                SqlDataReader information = data_read.Read(sql);

                if (information.HasRows)
                {
                    MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return false;
                }

                Dao data_excute = new Dao();

                //插入用户信息

                sql = "INSERT INTO " + identity + "登录表 VALUES ('" + username + "','" + password + "');";//SQL插入数据语句
                int num = data_excute.Excute(sql);

                //返回信息值
                if (num == 1)
                    return true;
                else
                    return false;
            }
        }
```



## 4. 运动员权限

选择运动员权限登陆成功后，出现如下界面

![image-20210611110340454](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110340454.png)



### 4.1 已注册信息界面

​        该页显示该账号在系统内注册的全部运动员信息，并可以对信息进行增删改查工作

![image-20210611110401279](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110401279.png)

按钮介绍：

|   **图标**   | ![image-20210611110431764](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110431764.png) | ![image-20210611110435522](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110435522.png) | ![image-20210611110438284](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110438284.png) | ![image-20210611110441875](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110441875.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             添加                             |                             删除                             |                             主页                             |
|   **功能**   |    查找包含文本框内<br />输入字段的姓名<br />所对应的信息    |                 添加新的<br />注册运动员信息                 |                删除已有的<br />注册运动员信息                |                         返回登陆界面                         |
| **注意事项** |                                                              |                                                              |                先点击<br />需要删除的运动员行                |                                                              |

添加运动员界面：



![image-20210611110604772](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110604772.png)

代码：

检查内容：

1. 填写是否完整
2. 入学时间和毕业时间是否为日期格式
3. 毕业时间是否比入学时间晚
4. 用户名是否已被注册

```C#
private void queding_button_Click(object sender, EventArgs e)
        {
            if (login())
            {
                MessageBox.Show("添加运动员数据成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                this.Close();
            }
        }
        private bool login()
        {
            //从输入栏取出信息
            String xuhao = xuhao_textBox.Text.Trim();
            String xingming = xingming_textBox.Text.Trim();
            String xingbie = xingbie_textBox.Text.Trim();
            String xuexiao = xuexiao_textBox.Text.Trim();
            String ruxue = ruxue_textBox.Text.Trim();
            String biye = biye_textBox.Text.Trim();
            String jiaolian = jiaolian_textBox.Text.Trim();

            //返回填写不完整提醒
            if (xuhao == "" || xingming == "" || xingbie == "" || xuexiao == "" || ruxue == "" || biye == "" || jiaolian == "")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            //如果无法转换为日期，用try catch 实现报错
            try
            {
                //如果结束时间早于开始时间
                if (Convert.ToDateTime(ruxue) > Convert.ToDateTime(biye))
                {
                    MessageBox.Show("结束日期早于开始日期，请修改！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }
            }
            catch
            {
                MessageBox.Show("输入日期格式错误! ", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            String sql;
            //检查用户名是否已经被注册
            sql = "SELECT * FROM 运动员注册表 WHERE 运动员ID='" + xuhao + "'";//SQL查询语句

            SqlDataReader information = new Dao().Read(sql); //创建读数据库对象

            if (information.HasRows)
            {
                MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            sql = "INSERT INTO 运动员注册表 VALUES ('" + xuhao + "','" + Public_val.get_zhanghao() + "','" + xingming + "','"
                    + xingbie + "','" + xuexiao + "','" + ruxue + "','" + biye + "','" + jiaolian + "',0);";//SQL插入数据语句

            Dao data_excute = new Dao();

            //插入用户信息

            int num = data_excute.Excute(sql);
            //返回信息值
            if (num == 1)
                return true;
            else
                return false;
        }
```



### 4.2 已加入参赛队查看界面

​        该页显示该账号在系统内注册的全部生效运动员，所加入的参赛队信息，以及报名的号码和项目。该页仅可查看，无法对报名信息进行修改和删除。



![image-20210611110627008](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110627008.png)

按钮介绍：

| **图标** | ![image-20210611110650803](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110650803.png) | ![image-20210611110654719](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110654719.png) |
| :------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| **名称** |                             查找                             |                             主页                             |
| **功能** |     查找包含文本框内<br/>输入字段的姓名<br/>所对应的信息     |                         返回登陆界面                         |

功能代码：

查询代码：

```C#
private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            if (caozuo == "注册")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                    " FROM 运动员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' " +
                    "AND 运动员账号 = "+Public_val.get_zhanghao()+";";
                Dao data = new Dao();
                yundongyuanzhuce_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
            }
            else if (caozuo == "队伍")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "";

                if (yundongyuanname == "")
                {
                    sql = "SELECT * FROM 运动员信息表 WHERE 运动员ID IN " +
                        "(SELECT 运动员ID FROM 运动员注册表 WHERE 运动员账号 = '" + Public_val.get_zhanghao() + "');";
                }
                else
                {
                    sql = "SELECT 运动员ID, 参赛队ID, 号码, 报名项目一, 报名项目二" +
                    " FROM 运动员信息表 WHERE 运动员ID LIKE '%" + yundongyuanname + "%' ";
                }

                Dao data = new Dao();
                duiwu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员信息表");
            }
        }
```



添加代码：

```C#
private void add_toolStripButton_Click(object sender, EventArgs e)
        {
            yundongyuan_Add add = new yundongyuan_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            //显示加入的数据
            //String sql = "SELECT * FROM 运动员注册表;";
            String sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                " FROM 运动员注册表 WHERE 运动员账号='" + Public_val.get_zhanghao() + "';";
            Dao data = new Dao();
            yundongyuanzhuce_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
        }
```

删除代码：

```C#
private void delete_toolStripButton_Click(object sender, EventArgs e)
        {
            DialogResult res = MessageBox.Show("确定要删除该条记录？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
            //如果确定删除
            if (res == DialogResult.OK)
            {
                //执行删除操作
                String yundongyuan_ID = yundongyuanzhuce_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                String sql = "DELETE FROM 运动员注册表 WHERE 运动员ID = '" + yundongyuan_ID + "'";
                Dao data_delete = new Dao();
                int num = data_delete.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("删除成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }

                //显示数据
                sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                    " FROM 运动员注册表 WHERE 运动员账号= '" + Public_val.get_zhanghao()+"';";
                //sql = "SELECT * FROM 运动员注册表;";
                Dao data_delete_show = new Dao();
                yundongyuanzhuce_dataGridView.DataSource = data_delete_show.SqlDataGridView_Show(sql, "运动员注册表");
            }
        }
```



## 5. 教练员权限

​       选择教练员权限登陆成功后，出现如下界面

![image-20210611110804288](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110804288.png)



### 5.1 已注册信息界面

​        该页显示该账号在系统内注册的全部教练员信息，并可以对信息进行增删改查工作

按钮介绍：

|   **图标**   | ![image-20210611110947221](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110947221.png) | ![image-20210611110952956](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110952956.png) | ![image-20210611110957289](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611110957289.png) | ![image-20210611111000392](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111000392.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             添加                             |                             删除                             |                             主页                             |
|   **功能**   |    查找包含文本框内<br />输入字段的姓名<br />所对应的信息    |                 添加新的<br />注册教练员信息                 |                删除已有的<br />注册教练员信息                |                         返回登陆界面                         |
| **注意事项** |                                                              |                                                              |             先点击<br />需要删除的<br />教练员行             |                                                              |

添加教练员界面：

![image-20210611111145372](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111145372.png)

代码：

检查内容：

1. 填写是否完整
2. 用户名是否已被注册

```C#
private void queding_button_Click(object sender, EventArgs e)
        {
            if (login())
            {
                MessageBox.Show("添加教练员数据成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                this.Close();
            }
        }
        private bool login()
        {
            //从输入栏取出信息
            String xuhao = xuhao_textBox.Text.Trim();
            String xingming = xingming_textBox.Text.Trim();
            String zhicheng = zhicheng_textBox.Text.Trim();
            String xuexiao = xuexiao_textBox.Text.Trim();

            //返回填写不完整提醒
            if (xuhao == "" || xingming == "" || zhicheng == "" || xuexiao == "")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            String sql;
            //检查用户名是否已经被注册
            sql = "SELECT * FROM 教练员注册表 WHERE 教练员ID='" + xuhao + "'";//SQL查询语句

            SqlDataReader information = new Dao().Read(sql); //创建读数据库对象

            if (information.HasRows)
            {
                MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            sql = "INSERT INTO 教练员注册表 VALUES ('" + xuhao + "','" + Public_val.get_zhanghao() + "','" + xingming + "','"
                     + xuexiao + "','"  +  zhicheng + "',0);";//SQL插入数据语句

            Dao data_excute = new Dao();

            //插入用户信息

            int num = data_excute.Excute(sql);
            //返回信息值
            if (num == 1)
                return true;
            else
                return false;
        }
```



### 5.2 已加入参赛队查看界面

​        该页显示该账号在系统内注册的全部生效教练员，所加入的参赛队信息。该页仅可查看，无法对报名信息进行修改和删除。

按钮介绍：

| **图标** | ![image-20210611111219630](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111219630.png) | ![image-20210611111222541](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111222541.png) |
| :------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| **名称** |                             查找                             |                             主页                             |
| **功能** |    查找包含文本框内<br />输入字段的姓名<br />所对应的信息    |                         返回登陆界面                         |

查询代码：

```C#
private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            if (caozuo == "注册")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                    " FROM 教练员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' " +
                    "AND 教练员账号 = "+Public_val.get_zhanghao()+";";
                Dao data = new Dao();
                jiaolianyuanzhuce_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
            }
            else if (caozuo == "队伍")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "";

                if (yundongyuanname == "")
                {
                    sql = "SELECT * FROM 教练员信息表 WHERE 教练员ID IN " +
                        "(SELECT 教练员ID FROM 教练员注册表 WHERE 教练员账号 = '" + Public_val.get_zhanghao() + "' );";
                }
                else
                {
                    sql = "SELECT *" +
                    " FROM 教练员信息表 WHERE 教练员ID LIKE '%" + yundongyuanname + "%' ";
                }

                Dao data = new Dao();
                duiwu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员信息表");
            }
        }
```

添加代码：

```C#
private void add_toolStripButton_Click(object sender, EventArgs e)
        {
            jiaolianyuan_Add add = new jiaolianyuan_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            //显示加入的数据
            //String sql = "SELECT * FROM 运动员注册表;";
            String sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                " FROM 教练员注册表 WHERE 教练员账号= '" + Public_val.get_zhanghao() + "';";
            Dao data = new Dao();
            jiaolianyuanzhuce_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
        }
```

删除代码：

```C#
private void delete_toolStripButton_Click(object sender, EventArgs e)
        {
            DialogResult res = MessageBox.Show("确定要删除该条记录？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
            //如果确定删除
            if (res == DialogResult.OK)
            {
                //执行删除操作
                String yundongyuan_ID = jiaolianyuanzhuce_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                String sql = "DELETE FROM 教练员注册表 WHERE 教练员ID = '" + yundongyuan_ID + "'";
                Dao data_delete = new Dao();
                int num = data_delete.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("删除成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }

                //显示数据
                sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                    " FROM 教练员注册表 WHERE 教练员账号= '" + Public_val.get_zhanghao()+"' ;";
                //sql = "SELECT * FROM 运动员注册表;";
                Dao data_delete_show = new Dao();
                jiaolianyuanzhuce_dataGridView.DataSource = data_delete_show.SqlDataGridView_Show(sql, "教练员注册表");
            }
        }
```



## 6. 参赛队管理员权限

### 6.1 运动会选择界面

选择参赛队管理员权限登陆成功后，出现如下界面：

![image-20210611111310488](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111310488.png)

该页中选择下面需要操作的运动会。

同时可以查看目前生效的运动会信息。

按钮介绍：

| **图标**     | ![image-20210611111341279](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111341279.png) | ![image-20210611111345174](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111345174.png) | ![image-20210611111347878](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111347878.png) |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **名称**     | 查找                                                         | 进入                                                         | 主页                                                         |
| **功能**     | 查找包含文本框内<br />输入字段的运动会名称所对应的信息       | 进入需要操作的<br />运动会界面                               | 返回登陆界面                                                 |
| **注意事项** |                                                              | 先点击<br />需要进入的<br />运动会行                         |                                                              |

代码：

查找按钮：

```c#
 private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            String sportsname = name_input_toolStripTextBox.Text.Trim();
            String sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname +"%' AND 生效标记 = 1 ;";
            Dao data = new Dao();
            sports_meetings_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动会信息表");
        }
```

进入按钮：

```C#
private void choose_toolStripButton_Click(object sender, EventArgs e)
        {
            Public_val.set_yundonghui(sports_meetings_dataGridView.SelectedRows[0].Cells[0].Value.ToString());
            MessageBox.Show("您已选择"+sports_meetings_dataGridView.SelectedRows[0].Cells[1].Value.ToString()+
                ",正在进入","提示", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

            xuexiao_xuanze xuexiao = new xuexiao_xuanze();
            this.Hide();
            xuexiao.ShowDialog();
            this.Show();
            if (Public_val.home_flag == true)
            {
                Public_val.home_flag = false;
                this.Close();
            }
        }
```



### 6.2 学校选择界面

​        选择运动会成功后，出现如下界面：

![image-20210611111442440](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111442440.png)

​        填入需要操作的学校名称，并填写验证码，验证码询问本校管理员或拨打电话13695697247。

​        代码：

确定按钮：

```c#
if (yanzhengma_textBox.Text == "******")
            {
                Public_val.set_xuexiao(mingcheng_textBox.Text);
                MessageBox.Show("您已选择" + mingcheng_textBox.Text +
                    ",正在进入", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);

                //打开参赛队管理界面
                cansaidui_caozuo cansaidui = new cansaidui_caozuo();
                this.Hide();
                cansaidui.ShowDialog();
                this.Show();
                //主页按钮
                if (Public_val.home_flag == true)
                {
                    this.Close();
                }
            }
            else
            {
                MessageBox.Show("验证码错误", "提示", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
            }
```



### 6.3 参赛队管理员操作界面

​        学校名称与验证码填写成功后，出现如下界面

![image-20210611111513119](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111513119.png)

#### 6.3.1 查看信息

​        点击“查看信息“后，在下拉列表中选择具体查看的信息

![image-20210611111527886](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111527886.png)

​        以运动员为例，点击后显示页面为

![image-20210611111540214](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111540214.png)

​        本页面中可以查看本学校全部已生效运动员的信息，即组建参赛队时全部可以添加的运动员。

​        教练员界面同上。



项目界面

![image-20210611111626482](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111626482.png)

​        本页面中可以查看本次运动会全部比赛项目的信息，即组建参赛队时运动员可以报名的项目。

#### 6.3.2 组建参赛队

​        点击“组件参赛队“后，显示界面如下：

![image-20210611111955808](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611111955808.png)

其中分为“左“”右上“”右下“三处显示框。

a. “左“处显示框为本账号创建全部参赛队信息。

b. “右上“处显示框为选择的账号包含运动员信息。

c. “右下“处显示框为选择的账号包含教练员信息。

 

界面级联操作代码：

```c#
private void cansaidui_dataGridView_CellMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            String team="";
            //当前选中队伍

            team = cansaidui_dataGridView.SelectedRows[0].Cells[0].Value.ToString();

            if (team == "") team = "1";

            //加载并连接数据表
            String sql = "SELECT 运动员ID, 号码, 报名项目一, 报名项目二" +
            " FROM 运动员信息表 WHERE 参赛队ID = '" + team + "';";
            Dao data_2 = new Dao();
            dt1 = data_2.SqlDataGridView_Show(sql, "报名运动员信息表");
            yundongyuan_cansai_dataGridView.DataSource = dt1;

            sql = "SELECT 教练员ID" +
            " FROM 教练员信息表 WHERE 参赛队ID = '" + team + "';";
            Dao data_3 = new Dao();
            dt2 = data_3.SqlDataGridView_Show(sql, "报名教练员信息表");
            jiaolianyuan_cansai_dataGridView.DataSource = dt2;

            toolStripSeparator2.Visible = true;
            delete_toolStripButton.Visible = true;
            toolStripSeparator3.Visible = true;
            change_toolStripButton.Visible = true;
            toolStripSeparator4.Visible = true;
            baocun_toolStripButton.Visible = true;
        }
```



​        此时界面仅有“查询“，”增加“两个按钮点击左侧参赛队中任一数据行后，显示管理参赛队按钮。

![image-20210611112011372](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112011372.png)

​        直接在“右上“与”右下“数据表中输入数据，即可实现参赛队的组建。

按钮介绍：

|   **图标**   | ![image-20210611112059998](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112059998.png) | ![image-20210611112104799](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112104799.png) | ![image-20210611112108264](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112108264.png) | ![image-20210611112112152](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112112152.png) | ![image-20210611112115386](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112115386.png) | ![image-20210611112118324](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112118324.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             增加                             |                             删除                             |                             编辑                             |                             保存                             |                             主页                             |
|   **功能**   |    查找包含文本框内<br />输入字段的参赛队名称所对应的信息    |                 添加<br />参赛队 <br />信息                  |                    删除<br />参赛队  信息                    |                 编辑<br />参赛队 <br />信息                  |      保存自上次点击保存后，<br />对运动员和教练员的更改      |                     返回<br /> 登陆界面                      |
| **注意事项** |                                                              |                  先点击  需要进入的参赛队行                  |                  先点击  需要删除的参赛队行                  |                  先点击  需要编辑的参赛队行                  | 对某一行进行更改后，需要单机该行以外界面才可保存对该行的更改 |                                                              |

代码：

查询按钮：

```C#
private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            if (identity == "运动员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 运动员ID, 姓名, 性别, 入学时间, 毕业时间, 教练员ID " +
                    " FROM 运动员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' AND 学校 = '" + Public_val.get_xuexiao() + "';";
                Dao data = new Dao();
                yundongyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
            }
            else if (identity == "教练员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 教练员ID, 姓名, 职称 " +
                    " FROM 教练员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' AND 学校 = '"+Public_val.get_xuexiao()+"';";
                Dao data = new Dao();
                jiaolianyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
            }
            else if (identity == "项目")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 项目ID , 项目名称, 项目类型, 团体项目标记" +
                    " FROM 项目信息表 WHERE 项目名称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "' ;";
                Dao data = new Dao();
                xiangmu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "项目信息表");
            }
            else if (identity == "参赛队")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 参赛队ID, 参赛队全称, 最小号码, 最大号码, 生效标记" +
                    " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "' AND 学校 = '" + Public_val.get_xuexiao() + "' ;";
                Dao data = new Dao();
                cansaidui_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "参赛队信息表");
            }
        }
```



添加按钮：

```C#
private void add_toolStripButton_Click(object sender, EventArgs e)
        {
            cansaidui_Add add = new cansaidui_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
            //显示加入的数据
            String sql = "SELECT 参赛队ID, 参赛队全称, 最小号码, 最大号码, 生效标记" +
                    " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "' AND 学校 = '" + Public_val.get_xuexiao() + "' ;";
            Dao data = new Dao();
            cansaidui_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "参赛队信息表");
        }
```



删除按钮：

```c#
private void delete_toolStripButton_Click(object sender, EventArgs e)
        {
            DialogResult res = MessageBox.Show("确定要删除该条记录？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
            //如果确定删除
            if (res == DialogResult.OK)
            {
                //执行删除操作
                String cansaidui_ID = cansaidui_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                String sql = "DELETE FROM 参赛队信息表 WHERE 参赛队ID = '" + cansaidui_ID + "'";
                Dao data_delete = new Dao();
                int num = data_delete.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("删除成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }

                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                //查看删除后的表
                sql = "SELECT 参赛队ID, 参赛队全称, 最小号码, 最大号码, 生效标记" +
                    " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "' AND 学校 = '" + Public_val.get_xuexiao() + "' ;"; 
                //sql = "SELECT * FROM 运动员注册表;";
                Dao data_delete_show = new Dao();
                cansaidui_dataGridView.DataSource = data_delete_show.SqlDataGridView_Show(sql, "参赛队信息表");
            }
        }
```

更改按钮：

```C#
private void change_toolStripButton_Click(object sender, EventArgs e)
        {
            //更改使能
            Public_val.change_flag = true;
            Public_val.change_xuhao = cansaidui_dataGridView.SelectedRows[0].Cells[0].Value.ToString();

            //调用
            cansaidui_Add add = new cansaidui_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            Public_val.change_flag = false;

            String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
            //查看删除后的表
            String sql = "SELECT 参赛队ID, 参赛队全称, 最小号码, 最大号码, 生效标记" +
                " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "' AND 学校 = '" + Public_val.get_xuexiao() + "' ;";
            Dao data_delete_show = new Dao();
            cansaidui_dataGridView.DataSource = data_delete_show.SqlDataGridView_Show(sql, "参赛队信息表");
        }
```

保存参赛队更改按钮：

检查内容：

1. 是否填写完整
2. 运动员是否为该校生效成员
3. 运动员是否重复报名
4. 教练员是否为该校生效成员
5. 教练员是否重复报名
6. 号码是否在参赛队最小号码和最大号码范围内
7. 运动员报名项目是否在项目表中



最后输出每张表每种更改的数目

```C#
private void baocun_toolStripButton_Click(object sender, EventArgs e)
        {
            String sql="";
            //当前选中队伍
            String team = cansaidui_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
            if (team == "") team = "1";

            //判断增删改,先运动员表

            //加载更改
            DataTable yundongyuan_change = dt1.GetChanges();
            //利用循环读取行

            //如果有更改
            if (yundongyuan_change != null)
            {
                //计数
                int add = 0, delete = 0, modify = 0;
                //循环判断
                foreach (DataRow dr in yundongyuan_change.Rows)
                {
                    //判断每一行是什么操作
                    if (dr.RowState == System.Data.DataRowState.Added)
                    {
                        //填写不完整错误

                        if(dr["运动员ID"].ToString()==""|| dr["号码"].ToString()==""|| dr["报名项目一"].ToString()==""|| dr["报名项目二"].ToString() == "")
                        {
                            MessageBox.Show("填写不完整", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }

                        //主键错误（不在学校或者重复）

                        #region 编号检查存储过程
                        SqlDataAdapter da = new Dao().SqlProcedure("check_ID_yundongyuan");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps_xuhao = {
                                 new SqlParameter("@运动员ID",dr["运动员ID"].ToString()),
                                 new SqlParameter("@参赛队ID",team),
                                 new SqlParameter("@学校",Public_val.get_xuexiao()),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps_xuhao[3].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps_xuhao);
                        DataTable dt_xuhao = new DataTable();
                        da.Fill(dt_xuhao);
                        if (ps_xuhao[3].Value.ToString() == "0")
                        {
                            MessageBox.Show("运动员重复报名或没有此注册运动员信息！", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion


                        //号码不在范围错误，重复错误

                        #region 查号码存储过程
                        da = new Dao().SqlProcedure("check_haoma");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps = {
                                 new SqlParameter("@号码",dr["号码"].ToString()),//Text获取显示在下拉列表控件中的文本值
                                 new SqlParameter("@参赛队ID",team),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps[2].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps);
                        DataTable dt = new DataTable();
                        da.Fill(dt);
                        if (ps[2].Value.ToString() == "0")
                        {
                            MessageBox.Show("同参赛队号码存在重复", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion

                        //报名项目:在项目表中

                        #region 查项目存储过程
                        da = new Dao().SqlProcedure("check_xiangmu");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps_xiangmu = {
                                 new SqlParameter("@项目ID1",dr["报名项目一"].ToString()),
                                 new SqlParameter("@项目ID2",dr["报名项目二"].ToString()),
                                 new SqlParameter("@运动会ID",Public_val.get_yundonghui()),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps_xiangmu[3].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps_xiangmu);
                        DataTable dt_xiangmu = new DataTable();
                        da.Fill(dt_xiangmu);
                        if (ps_xiangmu[3].Value.ToString() == "0")
                        {
                            MessageBox.Show("项目不在项目表中，请检查！", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion

                        //sql语句
                        sql = "INSERT INTO 运动员信息表 VALUES ('" + dr["运动员ID"].ToString() + "' , '" + team + "' , '" + dr["号码"].ToString() + "' , '" + dr["报名项目一"].ToString() + "' , '" + dr["报名项目二"].ToString() + "' );";
                        //计数
                        add++;
                    }
                    else if (dr.RowState == System.Data.DataRowState.Deleted)
                    {
                        //sql语句
                        sql = "DELETE 运动员信息表 WHERE 运动员ID = '" + dr["运动员ID",DataRowVersion.Original].ToString() + "' ; ";
                        //计数
                        delete++;
                    }
                    else if (dr.RowState == System.Data.DataRowState.Modified)
                    {
                        //填写不完整错误

                        if (dr["运动员ID"].ToString() == "" || dr["号码"].ToString() == "" || dr["报名项目一"].ToString() == "" || dr["报名项目二"].ToString() == "")
                        {
                            MessageBox.Show("填写不完整", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }

                        //禁止修改主键
                        if (dr["运动员ID"].ToString() != dr["运动员ID", DataRowVersion.Original].ToString())
                        {
                            MessageBox.Show("禁止修改运动员编号", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }

                        //号码不在范围错误+重复错误

                        #region 查号码存储过程
                        SqlDataAdapter da = new Dao().SqlProcedure("check_haoma");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps = {
                                 new SqlParameter("@号码",dr["号码"].ToString()),//Text获取显示在下拉列表控件中的文本值
                                 new SqlParameter("@参赛队ID",team),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps[2].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps);
                        DataTable dt = new DataTable();
                        da.Fill(dt);
                        if (ps[2].Value.ToString() == "0")
                        {
                            MessageBox.Show("同参赛队号码存在重复", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion

                        //报名项目重复问题当作我自己写了
                        //报名项目：必须在项目表内

                        #region 查项目存储过程
                        da = new Dao().SqlProcedure("check_xiangmu");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps_xiangmu = {
                                 new SqlParameter("@项目ID1",dr["报名项目一"].ToString()),
                                 new SqlParameter("@项目ID2",dr["报名项目二"].ToString()),
                                 new SqlParameter("@运动会ID",Public_val.get_yundonghui()),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps_xiangmu[3].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps_xiangmu);
                        DataTable dt_xiangmu = new DataTable();
                        da.Fill(dt_xiangmu);
                        if (ps_xiangmu[3].Value.ToString() == "0")
                        {
                            MessageBox.Show("项目不在项目表中，请检查！", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion

                        sql = "UPDATE 运动员信息表 SET 号码 = '"+ dr["号码"].ToString() + "', 报名项目一 = '"+ dr["报名项目一"].ToString() + "',报名项目二 = '"+ dr["报名项目二"].ToString() + "' WHERE 运动员ID = '" + dr["运动员ID"].ToString() + "' ; ";
                        //计数
                        modify++;
                    }

                    //开始操作
                    Dao data_caozuo = new Dao();
                    data_caozuo.Excute(sql);
                }
                //操作

                //查看操作后的表,并重新连接
                //如果没改，不用更新
                if(add==0&&delete==0&&modify==0) MessageBox.Show("运动员表未进行更改", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                else
                {
                    MessageBox.Show("运动员表更改成功\n共增加" + add + "条记录\n共删除" + delete + "条记录\n共修改" + modify + "条记录", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    sql = "SELECT 运动员ID, 号码, 报名项目一, 报名项目二" +
                        " FROM 运动员信息表 WHERE 参赛队ID = '" + team + "' ;";
                    Dao data_show = new Dao();
                    dt1 = data_show.SqlDataGridView_Show(sql, "运动员信息表");
                    yundongyuan_cansai_dataGridView.DataSource = dt1;
                }
            }
            else
            {
                MessageBox.Show("运动员表未进行更改", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
            

            //后教练员表

            //加载更改
            DataTable jiaolianyuan_change = dt2.GetChanges();

            if (jiaolianyuan_change != null)
            {
                //计数
                int add = 0, delete = 0;
                //利用循环读取行
                foreach (DataRow dr in jiaolianyuan_change.Rows)
                {
                    //判断每一行是什么操作
                    if (dr.RowState == System.Data.DataRowState.Added)
                    {
                        //主键错误（不在学校或者重复）

                        #region 编号检查存储过程
                        SqlDataAdapter da = new Dao().SqlProcedure("check_ID_jiaolianyuan");
                        //1.如果传入了存储过程，必须告诉服务器按存储过程进行处理，否则就会按sql语句进行处理
                        da.SelectCommand.CommandType = CommandType.StoredProcedure;
                        //2.创建存储过程中所需要的参数，注意：名称必须与存储过程的参数名称对应
                        SqlParameter[] ps_xuhao = {
                                 new SqlParameter("@教练员ID",dr["教练员ID"].ToString()),
                                 new SqlParameter("@参赛队ID",team),
                                 new SqlParameter("@学校",Public_val.get_xuexiao()),
                                 new SqlParameter("@result",SqlDbType.Int)
                        };
                        ps_xuhao[3].Direction = ParameterDirection.ReturnValue;
                        //3.将参数传递给服务器使用
                        da.SelectCommand.Parameters.AddRange(ps_xuhao);
                        DataTable dt_xuhao = new DataTable();
                        da.Fill(dt_xuhao);
                        if (ps_xuhao[3].Value.ToString() == "0")
                        {
                            MessageBox.Show("教练员重复报名或没有此注册教练员信息！", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                            continue;
                        }
                        #endregion

                        //sql语句
                        sql = "INSERT INTO 教练员信息表 VALUES ('" + dr["教练员ID"].ToString() + "' , '" + team + "' );";
                        //计数
                        add++;
                    }
                    else if (dr.RowState == System.Data.DataRowState.Deleted)
                    {
                        //sql语句
                        sql = "DELETE 教练员信息表 WHERE 教练员ID = '" + dr["教练员ID", DataRowVersion.Original].ToString() + "' ; ";
                        //计数
                        delete++;
                    }
                    else if (dr.RowState == System.Data.DataRowState.Modified)
                    {
                        //不允许更改
                        MessageBox.Show("禁止修改教练员编号", "警告", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        continue;
                    }

                    //开始操作
                    Dao data_caozuo = new Dao();
                    data_caozuo.Excute(sql);
                }

                //查看操作后的表,并重新连接
                //如果没改，不用更新
                if (add == 0 && delete == 0) MessageBox.Show("教练员表未进行更改", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                else
                {
                    //查看操作后的表,并重新连接
                    MessageBox.Show("教练员表更改成功\n共增加" + add + "条记录\n共删除" + delete + "条记录", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    sql = "SELECT 教练员ID" +
                        " FROM 教练员信息表 WHERE 参赛队ID = '" + team + "' ;";
                    Dao data_show = new Dao();
                    dt2 = data_show.SqlDataGridView_Show(sql, "教练员信息表");
                    jiaolianyuan_cansai_dataGridView.DataSource = dt2;
                }
            }
            else
            {
                MessageBox.Show("教练员表未进行更改", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }
```

添加参赛队界面：

![image-20210611112216561](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112216561.png)



参赛队添加代码

检查内容：

1. 填写是否完整

2. 最小号码是否大于最大号码
3. 参赛队序号是否已经被注册

```C#
 private void queding_button_Click(object sender, EventArgs e)
        {
            if (login())
            {
                if(Public_val.change_flag == false)
                {
                    MessageBox.Show("添加参赛队数据成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    this.Close();
                }
                else
                {
                    this.Close();
                }
            }
        }

        private bool login()
        {
            //从输入栏取出信息
            String xuhao = xuhao_textBox.Text.Trim();
            String mingcheng = mingcheng_textBox.Text.Trim();
            String max = max_textBox.Text.Trim();
            String min = min_textBox.Text.Trim();

            //返回填写不完整提醒
            if (xuhao == "" || mingcheng == "" || max == "" || min == "")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            //如果无法转换为数字，用try catch 实现报错
            try
            {
                int max_num = Convert.ToInt32(max);
                int min_num = Convert.ToInt32(min);
                //如果结束时间早于开始时间
                if ( min_num > max_num )
                {
                    MessageBox.Show("最小号码大于最大号码，请修改！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                //如果数字号码簿范围不是四位
                if (min_num < 0 || min_num > 9999 || max_num < 0 || max_num > 9999)
                {
                    MessageBox.Show("输入号码格式错误! ", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }
            }
            catch
            {
                MessageBox.Show("输入号码格式错误! ", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }

            String sql;
            int num;

            #region 更改操作
            if (Public_val.change_flag == true)
            {
                //序号不可以更改
                if (xuhao != Public_val.change_xuhao)
                {
                    MessageBox.Show("序号不可以更改", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }

                //更改操作
                sql = "UPDATE 参赛队信息表 SET 参赛队全称 = '" + mingcheng + "' ,最小号码 = '" + min + "',最大号码 = '" + max +
                    "' WHERE 参赛队ID = '" + xuhao + "'";
                Dao data_update = new Dao();
                num = data_update.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("更改成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    return true;
                }
            }
            #endregion

            //检查用户名是否已经被注册
            sql = "SELECT * FROM 参赛队信息表 WHERE 参赛队ID='" + xuhao + "'";//SQL查询语句

            SqlDataReader information = new Dao().Read(sql); //创建读数据库对象

            if (information.HasRows)
            {
                MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            sql = "INSERT INTO 参赛队信息表 VALUES ('" + xuhao + "','" + Public_val.get_yundonghui() + "','"+Public_val.get_xuexiao() + "','" + mingcheng + "','"
                    + min + "','" + max + "',0);";//SQL插入数据语句

            Dao data_excute = new Dao();

            //插入用户信息

            num = data_excute.Excute(sql);
            //返回信息值
            if (num == 1)
                return true;
            else
                return false;
        }
```



## 7. 主办方管理员权限

### 7.1 运动会选择界面

​        选择主办方管理员权限登陆成功后，出现如下界面：

![image-20210611112233252](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112233252.png)

​        该页中选择下面需要操作的运动会。

​        同时可以增删改查运动会信息，以及查看过去已删除（即已失效）的运动会信息

​        （并非真正删除，是将生效标记更改为0）

按钮介绍：

|   **图标**   | ![image-20210611112309016](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112309016.png) | ![image-20210611112311589](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112311589.png) | ![image-20210611112315012](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112315012.png) | ![image-20210611112318231](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112318231.png) | ![image-20210611112321167](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112321167.png) | ![image-20210611112327149](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112327149.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             进入                             |                             增加                             |                             删除                             |                             历史                             |                             主页                             |
|   **功能**   |    查找包含文本框内<br />输入字段的运动会名称所对应的信息    |                  进入需要操作的  运动会界面                  |                  增加<br />运动会<br />信息                  |                  删除<br />运动会<br />信息                  |                查看<br />所有历史<br />运动会                |                         返回登录界面                         |
| **注意事项** |                                                              |                   先点击需要操作的运动会行                   |                                                              |                                                              |       包括已经删除失效运动会<br />和未删除的生效运动会       |                                                              |

代码：

查询按钮：

```C#
        private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            String sportsname = name_input_toolStripTextBox.Text.Trim();
            String sql;
            //是否显示被删除的运动会
            if (quanbu == false)
            {
                sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname + "%' AND 生效标记 = 1 ;";
            }
            else
            {
                sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname + "%' ;";

            }
            Dao data = new Dao();
            sports_meetings_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动会信息表");
        }
```

进入按钮：

```C#
private void choose_toolStripButton_Click(object sender, EventArgs e)
        {
            Public_val.set_yundonghui(sports_meetings_dataGridView.SelectedRows[0].Cells[0].Value.ToString());
            MessageBox.Show("您已选择" + sports_meetings_dataGridView.SelectedRows[0].Cells[1].Value.ToString() +
                ",正在进入", "提示", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

            zhubanfang_caozuo zhubanfang = new zhubanfang_caozuo();
            this.Hide();
            zhubanfang.ShowDialog();
            this.Show();

            //主页键
            if (Public_val.home_flag == true)
            {
                Public_val.home_flag = false;
                this.Close();
            }
        }
```

增加按钮：

```C#
private void add_toolStripButton_Click(object sender, EventArgs e)
        {
            this.Hide();
            Sports_Meetings_Add add = new Sports_Meetings_Add();
            add.ShowDialog();
            this.Show();
            //显示添加后的表
            String sportsname = name_input_toolStripTextBox.Text.Trim();
            String sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname + "%' AND 生效标记 = 1 ;";
            Dao data = new Dao();
            sports_meetings_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动会信息表");
        }
```

删除按钮：

```C#
private void delete_toolStripButton_Click(object sender, EventArgs e)
        {
            DialogResult res = MessageBox.Show("\t确定要删除该条记录？\n您可以在'查看往期运动会'按钮中查看已删除的运动会", "提示", MessageBoxButtons.OKCancel,MessageBoxIcon.Question);
            //如果确定删除
            if (res == DialogResult.OK)
            {
                //执行删除操作
                String sport_meeting_ID = sports_meetings_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                String sql = "UPDATE 运动会信息表 SET 生效标记 = 0 WHERE 运动会ID = '"+sport_meeting_ID+"'";
                Dao data_delete = new Dao();
                int num = data_delete.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("删除成功", "提示",MessageBoxButtons.OK,MessageBoxIcon.Information);
                }

                //显示数据
                sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 生效标记 = 1 ;";
                Dao data_delete_show = new Dao();
                sports_meetings_dataGridView.DataSource = data_delete_show.SqlDataGridView_Show(sql, "运动会信息表");
            }
        }
```

历史按钮：

```C#
private void quanbu_toolStripButton_Click(object sender, EventArgs e)
        {
            //设置全部
            if (quanbu == true)
            {
                quanbu = false;
                quanbu_toolStripButton.Text = "查看往期运动会";
            }
            else
            {
                quanbu = true;
                quanbu_toolStripButton.Text = "查看生效运动会";
            }

            String sportsname = name_input_toolStripTextBox.Text.Trim();
            String sql;

            if (quanbu == true)
            {
                sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname + "%' ;";
            }
            else
            {
                sql = "SELECT 运动会ID, 运动会名称, 主办单位, 承办单位, 地点, 比赛时间, 结束时间 FROM 运动会信息表 WHERE 运动会名称 LIKE '%" + sportsname + "%' AND 生效标记 = 1;";
            }
            Dao data = new Dao();
            sports_meetings_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动会信息表");

        }
```

添加运动会界面

![image-20210611112347559](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112347559.png)

代码：

检查内容：

1. 填写是否完整
2. 结束时间是否早于开始时间

```C#
private void queding_button_Click(object sender, EventArgs e)
        {
            if (login())
            {
                MessageBox.Show("添加运动会数据成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                this.Close();
            }
        }

        private bool login()
        {
            //从输入栏取出信息
            String xuhao = xuhao_textBox.Text.Trim(); 
            String mingcheng = mingchen_textBox.Text.Trim();
            String zhuban = zhuban_textBox.Text.Trim();
            String chengban = chengban_textBox.Text.Trim();
            String didian = didian_textBox.Text.Trim();
            String start = start_shijian_textBox.Text.Trim();
            String end = end_shijian_textBox.Text.Trim();

            //返回填写不完整提醒
            if (xuhao == ""||mingcheng==""||zhuban==""||chengban==""||didian==""||start==""||end=="")
            {
                MessageBox.Show("输入不完整，请检查", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            //如果无法转换为日期，用try catch 实现报错
            try
            {
                //如果结束时间早于开始时间
                if (Convert.ToDateTime(start) > Convert.ToDateTime(end))
                {
                    MessageBox.Show("结束日期早于开始日期，请修改！", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return false;
                }
            }
            catch
            {
                MessageBox.Show("输入日期格式错误! ", "提示", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return false;
            }


            String sql;
            //检查用户名是否已经被注册
            sql = "SELECT * FROM 运动会信息表 WHERE 运动会ID='" + xuhao + "'";//SQL查询语句
                                                                    
            SqlDataReader information = new Dao().Read(sql); //创建读数据库对象

            if (information.HasRows)
            {
                MessageBox.Show("该账号名已经存在", "错误", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            sql = "INSERT INTO 运动会信息表 VALUES ('" + xuhao + "','" + mingcheng + "','"
                    + zhuban + "','" + chengban + "','" + didian + "','" + start + "','" + end + "', 1 );";//SQL插入数据语句

            Dao data_excute = new Dao();

            //插入用户信息

            int num = data_excute.Excute(sql);
            //返回信息值
            if (num == 1)
                return true;
            else
                return false;
        }
```



### 7.2 主办方管理员操作界面界面

​        选择运动会成功后，出现如下界面

![image-20210611112359755](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112359755.png)

#### 7.2.1 查看与管理信息

​        点击“查看与管理信息”后，在下拉列表中选择具体查看的信息：

![image-20210611112410478](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112410478.png)

​        以运动员界面为例，教练员界面与参赛队界面同理

​        点击运动员后，显示界面如下

![image-20210611112419752](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112419752.png)

​        此界面可以为运动员激活，并查看所有运动员信息，筛选未激活运动员。

 

按钮介绍：

|   **图标**   | ![image-20210611112454354](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112454354.png) | ![image-20210611112458255](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112458255.png) | ![image-20210611112500944](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112500944.png) | ![image-20210611112503685](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112503685.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             筛选                             |                             激活                             |                             主页                             |
|   **功能**   |    查找包含文本框内<br />输入字段的运动员名称所对应的信息    |                筛选出<br />未被激活  的运动员                |                          激活运动员                          |                         返回登陆界面                         |
| **注意事项** |                                                              |                                                              |               先点击<br />需要操作的  运动员行               |                                                              |

代码：

查找按钮：

```C#
private void search_toolStripButton_Click(object sender, EventArgs e)
        {
            if (identity == "运动员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                    " FROM 运动员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' ;";
                Dao data = new Dao();
                yundongyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
            }
            else if (identity == "教练员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                    " FROM 教练员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' ;";
                Dao data = new Dao();
                jiaolianyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
            }
            else if (identity == "参赛队")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 参赛队ID, 参赛队全称,学校, 最小号码, 最大号码, 生效标记" +
                    " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '"+Public_val.get_yundonghui()+"';";
                Dao data = new Dao();
                cansaidui_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "参赛队信息表");
            }
            else if (identity == "项目")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 项目ID , 项目名称, 项目类型, 团体项目标记" +
                    " FROM 项目信息表 WHERE 项目名称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "';";
                Dao data = new Dao();
                xiangmu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "项目信息表");
            }
        }
```



筛选按钮：

```C#
private void shaixuan_toolStripButton_Click(object sender, EventArgs e)
        {
            if (identity == "运动员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                    " FROM 运动员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' AND 生效标记 = 0;";
                Dao data = new Dao();
                yundongyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
            }
            else if (identity == "教练员")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                    " FROM 教练员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%' AND 生效标记 = 0;";
                Dao data = new Dao();
                jiaolianyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
            }
            else if (identity == "参赛队")
            {
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                String sql = "SELECT 参赛队ID, 参赛队全称, 学校 , 最小号码, 最大号码, 生效标记" +
                    " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "'" +
                    "AND 生效标记 = 0 ;";
                Dao data = new Dao();
                cansaidui_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "参赛队信息表");
            }
        }
```

激活按钮：

```C#
private void shezhi_toolStripButton_Click(object sender, EventArgs e)
        {
            if (identity == "运动员")
            {
                DialogResult res = MessageBox.Show("确定使该条记录生效？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
                //如果确定更改
                if (res == DialogResult.OK)
                {
                    //执行激活操作
                    String yundongyuan_ID = yundongyuan_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                    String sql = "UPDATE 运动员注册表 SET 生效标记 =1 WHERE 运动员ID = '" + yundongyuan_ID + "'";
                    Dao data_update = new Dao();
                    int num = data_update.Excute(sql);
                    if (num > 0)
                    {
                        MessageBox.Show("激活成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }

                    //显示更改后表
                    String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                    sql = "SELECT 运动员ID, 姓名, 性别, 学校, 入学时间, 毕业时间, 教练员ID, 生效标记" +
                        " FROM 运动员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%';";
                    Dao data = new Dao();
                    yundongyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "运动员注册表");
                }
            }
            else if (identity == "教练员")
            {
                DialogResult res = MessageBox.Show("确定使该条记录生效？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
                //如果确定更改
                if (res == DialogResult.OK)
                {
                    //执行激活操作
                    String jiaolianyuan_ID = jiaolianyuan_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                    String sql = "UPDATE 教练员注册表 SET 生效标记 =1 WHERE 教练员ID = '" + jiaolianyuan_ID + "'";
                    Dao data_update = new Dao();
                    int num = data_update.Excute(sql);
                    if (num > 0)
                    {
                        MessageBox.Show("激活成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }

                    //显示更改后表
                    String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                    sql = "SELECT 教练员ID, 姓名, 学校, 职称, 生效标记" +
                        " FROM 教练员注册表 WHERE 姓名 LIKE '%" + yundongyuanname + "%';";
                    Dao data = new Dao();
                    jiaolianyuan_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "教练员注册表");
                }
            }
            else if (identity == "参赛队")
            {
                DialogResult res = MessageBox.Show("确定使该条记录生效？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
                //如果确定更改
                if (res == DialogResult.OK)
                {
                    //执行激活操作
                    String cansaidui_ID = cansaidui_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                    String sql = "UPDATE 参赛队信息表 SET 生效标记 =1 WHERE 参赛队ID = '" + cansaidui_ID + "'";
                    Dao data_update = new Dao();
                    int num = data_update.Excute(sql);
                    if (num > 0)
                    {
                        MessageBox.Show("激活成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }

                    //显示更改后表
                    String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                    sql = "SELECT 参赛队ID, 参赛队全称, 学校,最小号码, 最大号码, 生效标记" +
                        " FROM 参赛队信息表 WHERE 参赛队全称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "';";
                    Dao data = new Dao();
                    cansaidui_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "参赛队信息表");
                }
            }
        }
```



#### 7.2.2 修改比赛项目

​        点击修改比赛项目，进入界面如下

![image-20210611112525231](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112525231.png)

​        此界面可以增删改查选定运动会项目信息。

按钮介绍：

|   **图标**   | ![image-20210611112606642](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112606642.png) | ![image-20210611112609838](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112609838.png) | ![image-20210611112612418](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112612418.png) | ![image-20210611112614786](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112614786.png) | ![image-20210611112617212](C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611112617212.png) |
| :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   **名称**   |                             查找                             |                             增加                             |                             删除                             |                             编辑                             |                             主页                             |
|   **功能**   |     查找包含文本框内<br />输入字段的项目名称所对应的信息     |                   添加<br />项目<br />信息                   |                   删除<br />项目<br />信息                   |                     编辑<br />项目  信息                     |                      返回<br />登陆界面                      |
| **注意事项** |                                                              |                 先点击<br />需要进入的项目行                 |                 先点击<br />需要删除的项目行                 |              先点击<br />需要编辑 <br />项目行               |                                                              |

添加按钮：

```C#
private void add_toolStripButton_Click(object sender, EventArgs e)
        {
            xiangmu_Add add = new xiangmu_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            //显示加入的数据
            String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
            String sql = "SELECT 项目ID , 项目名称, 项目类型, 团体项目标记" +
                " FROM 项目信息表 WHERE 项目名称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "';";
            Dao data = new Dao();
            xiangmu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "项目信息表");
        }
```

删除按钮：

```C#
private void delete_toolStripButton_Click(object sender, EventArgs e)
        {
            DialogResult res = MessageBox.Show("确定要删除该条记录？", "提示", MessageBoxButtons.OKCancel, MessageBoxIcon.Question);
            //如果确定删除
            if (res == DialogResult.OK)
            {
                //执行删除操作
                String xiangmu_ID = xiangmu_dataGridView.SelectedRows[0].Cells[0].Value.ToString();
                String sql = "DELETE FROM 项目信息表 WHERE 项目ID = '" + xiangmu_ID + "'";
                Dao data_delete = new Dao();
                int num = data_delete.Excute(sql);
                if (num > 0)
                {
                    MessageBox.Show("删除成功", "提示", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }

                //显示数据
                String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
                sql = "SELECT 项目ID , 项目名称, 项目类型, 团体项目标记" +
                    " FROM 项目信息表 WHERE 项目名称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "';";
                Dao data = new Dao();
                xiangmu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "项目信息表");
            }
        }
```

编辑按钮：

```C#
private void change_toolStripButton_Click(object sender, EventArgs e)
        {
            //更改使能
            Public_val.change_flag = true;
            Public_val.change_xuhao = xiangmu_dataGridView.SelectedRows[0].Cells[0].Value.ToString();

            //调用
            xiangmu_Add add = new xiangmu_Add();
            this.Hide();
            add.ShowDialog();
            this.Show();

            Public_val.change_flag = false;

            //显示加入的数据
            String yundongyuanname = name_input_toolStripTextBox.Text.Trim();
            String sql = "SELECT 项目ID , 项目名称, 项目类型, 团体项目标记" +
                " FROM 项目信息表 WHERE 项目名称 LIKE '%" + yundongyuanname + "%' AND 运动会ID = '" + Public_val.get_yundonghui() + "';";
            Dao data = new Dao();
            xiangmu_dataGridView.DataSource = data.SqlDataGridView_Show(sql, "项目信息表");

        }
```



​        主办方管理员为参赛队管理员提交的参赛队信息激活后，即可完成运动会参赛队整理，为运动会成功举办奠定基础。        

## 8. 页面设置代码

### 8.1 计时

进入页面开始计时

```c#
            toolStripStatusLabel3.Text = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
            timer1.Start();
```

```C#
/// <summary>
        /// 每1秒计时器跳转一次
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void timer1_Tick(object sender, EventArgs e)
        {
            toolStripStatusLabel3.Text = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
        }
```



### 8.2 返回主页

```C#
        private void home_toolStripButton_Click(object sender, EventArgs e)
        {
            Public_val.home_flag = true;
            this.Close();
        }
```



### 8.3 防止图片闪烁

防止图片闪烁代码：

```c#
 //防止图片闪烁
            this.DoubleBuffered = true;//设置本窗体
            SetStyle(ControlStyles.UserPaint, true);
            SetStyle(ControlStyles.AllPaintingInWmPaint, true); // 禁止擦除背景.
            SetStyle(ControlStyles.DoubleBuffer, true); // 双缓冲
```



### 8.4 修改图片为圆形

将图片改为圆形：

```c#
//将图片转换为圆形
            System.Drawing.Drawing2D.GraphicsPath path = new System.Drawing.Drawing2D.GraphicsPath();
            path.AddEllipse(0, 0, pictureBox.Width, pictureBox.Height);
            pictureBox.Region = new Region(path);
```

### 8.4 所有图标同步放大缩小

获得窗体数据

```C#
            //获得窗体数据
            x = this.Width;//获取窗体的宽度
            y = this.Height;//获取窗体的高度
            setTag(this);//调用方法
```

``` c#
private float x;//定义当前窗体的宽度
        private float y;//定义当前窗体的高度
        private void setTag(Control cons)
        {
            foreach (Control con in cons.Controls)
            {
                con.Tag = con.Width + ";" + con.Height + ";" + con.Left + ";" + con.Top + ";" + con.Font.Size;
                if (con.Controls.Count > 0)
                {
                    setTag(con);
                }
            }
        }
        private void setControls(float newx, float newy, Control cons)
        {
            //遍历窗体中的控件，重新设置控件的值
            foreach (Control con in cons.Controls)
            {
                //获取控件的Tag属性值，并分割后存储字符串数组
                if (con.Tag != null)
                {
                    string[] mytag = con.Tag.ToString().Split(new char[] { ';' });
                    //根据窗体缩放的比例确定控件的值
                    con.Width = Convert.ToInt32(System.Convert.ToSingle(mytag[0]) * newx);//宽度
                    con.Height = Convert.ToInt32(System.Convert.ToSingle(mytag[1]) * newy);//高度
                    con.Left = Convert.ToInt32(System.Convert.ToSingle(mytag[2]) * newx);//左边距
                    con.Top = Convert.ToInt32(System.Convert.ToSingle(mytag[3]) * newy);//顶边距
                    Single currentSize = System.Convert.ToSingle(mytag[4]) * newy;//字体大小
                    con.Font = new Font(con.Font.Name, currentSize, con.Font.Style, con.Font.Unit);
                    if (con.Controls.Count > 0)
                    {
                        setControls(newx, newy, con);
                    }
                }
            }
        }
        private void Form_first_Resize(object sender, EventArgs e)
        {
            float newx = (this.Width) / x;
            float newy = (this.Height) / y;
            setControls(newx, newy, this);
            //选中后位置不改变的bug
            if (quanxian_combobox.SelectedItem != null)
            {
                string people = quanxian_combobox.SelectedItem.ToString() + "登录";
                biaoti_label.Location = new Point(Convert.ToInt32(this.Width - people.Length * 10 * newx) / 2, Convert.ToInt32(newy * 30));
            }
        }
```

​       

### 8.5 随鼠标位置变化的提醒文字



输入框内灰色提醒文字：鼠标移上去提醒文字消失，移走提醒文字出现代码：



```C#
//默认显示
            zhanghao_textbox.Text = " 请输入账号";
            zhanghao_textbox.ForeColor = Color.LightGray;
            mima_textbox.Text = " 请输入密码";
            mima_textbox.ForeColor = Color.LightGray;
            quanxian_combobox.SelectedIndex = 0;
            quanxian_combobox.ForeColor = Color.LightGray;
```

```c#
 Boolean textboxHasText_zhanghao = false;//判断输入框是否有文本

        //账号显示文字
        private void zhanghao_textbox_MouseEnter(object sender, EventArgs e)
        {
            if (textboxHasText_zhanghao == false)
                zhanghao_textbox.Text = "";

            zhanghao_textbox.ForeColor = Color.Black;
        }

        private void zhanghao_textbox_MouseLeave(object sender, EventArgs e)
        {
            if (zhanghao_textbox.Text == "")
            {
                zhanghao_textbox.Text = " 请输入账号";
                zhanghao_textbox.ForeColor = Color.LightGray;
                textboxHasText_zhanghao = false;
            }
            else
                textboxHasText_zhanghao = true;
        }

        //密码显示文字

        Boolean textboxHasText_mima = false;//判断输入框是否有文本

        private void mima_textbox_MouseEnter(object sender, EventArgs e)
        {
            if (textboxHasText_mima == false)
                mima_textbox.Text = "";

            mima_textbox.ForeColor = Color.Black;
            mima_textbox.PasswordChar = '*';
        }

        private void mima_textbox_MouseLeave(object sender, EventArgs e)
        {
            if (mima_textbox.Text == "")
            {
                mima_textbox.PasswordChar = '\0';
                mima_textbox.Text = " 请输入密码";
                mima_textbox.ForeColor = Color.LightGray;
                textboxHasText_mima = false;
            }
            else
                textboxHasText_mima = true;
        }

        private void quanxian_combobox_MouseLeave(object sender, EventArgs e)
        {
            if (quanxian_combobox.Text == "——请选择身份——")
            {
                quanxian_combobox.ForeColor = Color.LightGray;
            }
            else
            {
                quanxian_combobox.ForeColor = Color.Black;
            }
        }

        private void quanxian_combobox_MouseEnter(object sender, EventArgs e)
        {
            if (quanxian_combobox.Text == "——请选择身份——")
            {
                quanxian_combobox.ForeColor = Color.Black;
            }
        }
```



 下拉列表中数据在标题显示

```C#
        private void quanxian_combobox_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (quanxian_combobox.Text != "——请选择身份——")
            {
            string people = quanxian_combobox.SelectedItem.ToString()+"登录";
            biaoti_label.Text = people;
            float newx = (this.Width) / x;
            float newy = (this.Height) / y;
            setControls(newx, newy, this);
            biaoti_label.Location = new Point(Convert.ToInt32(this.Width - people.Length * 10 * newx) / 2, Convert.ToInt32(newy * 30));
            }
        }
```





# 五、软件测试

|     模块     | 出现问题 | 是否通过 |
| :----------: | :------: | :------: |
|  登录与注册  |    无    |    是    |
|    运动员    |    无    |    是    |
|    教练员    |    无    |    是    |
| 参赛队管理员 |    无    |    是    |
| 主办方管理员 |    无    |    是    |



# 六、软件使用

软件使用方式见使用说明书

以创建参赛队为例，展示使用过程



运动员登录：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611113654220.png" alt="image-20210611113654220" style="zoom: 50%;" />

添加运动员：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114205665.png" alt="image-20210611114205665" style="zoom: 50%;" />

教练员注册省略



主办方管理员增加运动会后，进入运动会：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114423932.png" alt="image-20210611114423932" style="zoom: 50%;" />

激活运动员：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114502504.png" alt="image-20210611114502504" style="zoom:50%;" />

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114516971.png" alt="image-20210611114516971" style="zoom:50%;" />

增删改比赛项目省略



参赛队管理员，进入运动会省略

选择大学：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114644737.png" alt="image-20210611114644737" style="zoom:50%;" />

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114700087.png" alt="image-20210611114700087" style="zoom:50%;" />



添加参赛队：

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114751407.png" alt="image-20210611114751407" style="zoom: 33%;" />

<img src="C:\Users\13748\AppData\Roaming\Typora\typora-user-images\image-20210611114909682.png" alt="image-20210611114909682" style="zoom:33%;" />



成功后，主办方管理员激活此参赛队，全流程结束
